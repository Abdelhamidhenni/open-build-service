
Listen 82
Listen 444

# Passenger defaults
PassengerSpawnMethod "smart"
PassengerMaxPoolSize 20
PassengerMinInstances 2
PassengerPreStart https://api:444
PassengerPreStart https://build


# Just the overview page
<VirtualHost *:80>
        # just give an overview about this OBS instance via static web page
        DocumentRoot  "/srv/www/obs/overview"

        <Directory /srv/www/obs/overview>
           Options Indexes
           Allow from all
        </Directory>
</VirtualHost>


# Build Results
<VirtualHost *:82>
        # The resulting repositories
        DocumentRoot  "/obs/repos"

        <Directory /obs/repos>
           Options Indexes
           Allow from all
        </Directory>
</VirtualHost>


# OBS API
<VirtualHost *:444>
        ServerName api

	#  General setup for the virtual host
        DocumentRoot  "/srv/www/obs/api/public"
	ErrorLog /srv/www/obs/api/log/apache_error_log
	TransferLog /srv/www/obs/api/log/apache_access_log

	SSLEngine on

	SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL

	SSLCertificateFile /srv/obs/certs/server.crt
	SSLCertificateKeyFile /srv/obs/certs/server.key

        <Directory /srv/www/obs/api/public>
           AllowOverride all
           Options -MultiViews

           XForward on

           Allow from all
        </Directory>                                                                                                                                                                                         

	SetEnvIf User-Agent ".*MSIE.*" \
		 nokeepalive ssl-unclean-shutdown \
		 downgrade-1.0 force-response-1.0

	CustomLog /var/log/apache2/ssl_request_log   ssl_combined

</VirtualHost>


# OBS WEB interface
<VirtualHost *:443>
        ServerName webui

	#  General setup for the virtual host
        DocumentRoot  "/srv/www/obs/webui/public"
	ErrorLog /srv/www/obs/webui/log/apache_error_log
	TransferLog /srv/www/obs/webui/log/apache_access_log

	SSLEngine on

	SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL

	SSLCertificateFile /srv/obs/certs/server.crt
	SSLCertificateKeyFile /srv/obs/certs/server.key

        <Directory /srv/www/obs/webui/public>
           AllowOverride all
           Options -MultiViews

           Allow from all
        </Directory>                                                                                                                                                                                         

	SetEnvIf User-Agent ".*MSIE.*" \
		 nokeepalive ssl-unclean-shutdown \
		 downgrade-1.0 force-response-1.0

	CustomLog /var/log/apache2/ssl_request_log   ssl_combined

</VirtualHost>                                  


