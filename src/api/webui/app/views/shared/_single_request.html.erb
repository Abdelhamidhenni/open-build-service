<% elide_len ||= no_target ? 80 : 40
   source_package = source_package_for_request(req)
   source_project = source_project_for_request(req)
   request_type = request_type_for_request(req)
   target_package = target_package_for_request(req)
   target_project = target_project_for_request(req)
   if source_package && source_package != :multiple && source_project != :multiple
     source_url = url_for(controller: 'package', action: 'show', project: source_project, package: source_package)
     buildresult_url = url_for(controller: 'project', action: 'package_buildresult', project: source_project, package: source_package)
     source_exists = Webui::Package.exists?(source_project, source_package)
   else
     source_exists = false
   end
-%>

<tr id="tr_request_<%= "#{req.id}" %>">
  <td class="nowrap">
    <span class="hidden"><%= req.created_at.to_i %> - <%= req.id %></span>
    <%= fuzzy_time(req.created_at) %>
  </td>
  <td class="request_source">
    <% if source_package %>
        <% src_proj = format_projectname(source_project, req.creator)
           src_pack = elide(source_package, elide_len >> 1) %>
        <%= link_to_project(source_project, src_proj) %>
        / <%= link_to_package(source_project, source_package, src_pack) %>
    <% elsif source_project %>
        <%# Happens for maintenance requests, no source package there %>
        <%= link_to_project(source_project, elide(source_project, elide_len)) %>
    <% end %>
  </td>
  <% unless no_target %>
      <td class="request_target">
        <% if target_project %>
            <% if not @project or @project.name != target_project %><!-- <%= target_project %>  -->
                <% if target_package and not (source_exists and source_package == target_package) %> <!-- /<%= target_package %> -->
                    <% tgt_proj, tgt_pack = elide_two(target_project, target_package, elide_len) %>
                    <%= link_to_project(target_project, tgt_proj) %>
                    / <%= link_to_package(target_project, target_package, tgt_pack) %>
                <% else %>
                    <%= link_to_project(target_project, elide(target_project, elide_len)) %>
                <% end %>
            <% else %>
                <% if target_package and Webui::Package.exists?(@project.name, target_package) %> <!-- <%= target_package %> -->
                    <%= link_to_package(target_project, target_package, elide(target_package, elide_len)) %>
                <% elsif request_type == :delete %>
                    This project
                <% end %>
            <% end %>
        <% end %>
      </td>
  <% end %>
  <td class="nowrap"><%= render :partial => 'shared/user_with_realname_and_icon', :locals => { user: User.find_by_login(req['creator']), short: true } %></td>
  <td class="nowrap"><%= request_type %></td>
  <% if !hide_state %>
      <td class="nowrap"><%= req.state %></td>
  <% end %>
  <td>
    <%= link_to(sprite_tag('req-showdiff', title: "Show request ##{req.id}"),
                { :controller => :request, :action => :show, :id => req.id }, { :class => 'request_link' }) -%>
    <% if source_package && source_package != :multiple && source_exists %>
        <%= link_to(sprite_tag('information', title: 'Build results', id: "req_#{req.id}"), source_url) %>
        <%= javascript_tag do %>
            setup_buildresult_tooltip('<%= "req_#{req.id}" %>', '<%= buildresult_url %>')
        <% end %>
    <% end %>
  </td>
</tr>
