<% status = local_assigns.has_key?(:disable) ? 'disable' : 'enable' %>
<table class="flag_table" id="flag_table_<%= flag_type %>" data-flag="<%= flag_type %>">
  <tr>
    <th>Repository</th>
    <th style="width: 6ex">All</th>
    <% @architectures.each do |architecture| %>
      <th style="width: 6ex"><%= architecture.name %></th>
    <% end %>
  </tr>
  <!-- For all repositories -->
  <tr>
    <td class="reponame"><strong>All</strong></td>
    <!-- For all architectures -->
    <td class="allrow">
      <%= render partial: 'shared/repositories_flag_table_column', :locals => { flag: flags.with_repositories(nil).
                                                                                            with_architectures(nil).first,
                                                                                type: flag_type,
                                                                                repository: nil,
                                                                                architecture: nil } %>
    </td>
    <!-- Architecture specific -->
    <% @architectures.each do |architecture| %>
      <td class="allcolumn">
        <%= render partial: 'shared/repositories_flag_table_column', :locals => { flag: flags.with_repositories(nil).
                                                                                             with_architectures(architecture.id).first,
                                                                                  type: flag_type,
                                                                                  repository: nil,
                                                                                  architecture: architecture.name } %>
      </td>
    <% end %>
  </tr>
  <% @project.repositories.each do |repository| %>
    <tr>
      <td class="reponame">
        <strong title="<%= repository.name %>">
          <% if @package %>
            <%= link_to(elide(repository.name, 18), action: "binaries", project: @project, package: @package, repository: repository.name) %>
          <% else %>
            <%= link_to(elide(repository.name, 18), action: "repository_state", project: @project, repository: repository.name) %>
          <% end %>
        </strong>
      </td>
      <!-- For this repository for all architectures -->
      <td class="allrow">
        <%= render partial: 'shared/repositories_flag_table_column', :locals => { flag: flags.with_repositories(repository.name).
                                                                                              with_architectures(nil).first,
                                                                                  type: flag_type,
                                                                                  repository: repository.name ,
                                                                                  architecture: nil } %>
      </td>
      <% @architectures.each do |architecture| %>
        <td>
          <%= render partial: 'shared/repositories_flag_table_column', :locals => { flag: flags.with_repositories(repository.name).
                                                                                                with_architectures(architecture.id).first,
                                                                                    type: flag_type,
                                                                                    repository: repository.name,
                                                                                    architecture: architecture.name } %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>

<% content_for :ready_function do %>
  $( ".flag_spinner_trigger_<%= flag_type %>" ).click(function() {
    $( "#spinner_flag_table_<%= flag_type %>" ).show();
  });
<% end %>
