
<% @pagetitle = "Files of Package #{@package} (Project #{@project})" %>
<%
@crumb_list = [
  link_to( 'Projects', :controller => 'project', :action => :list_public),
  link_to( @project, :controller => 'project', :action => :show, :project => @project ),
  link_to( @package, :controller => 'package', :action => :show, :project => @project, :package => @package ),
  'Files'
]
-%>

<%= render :partial => "tabs" %>

<%= render :partial => 'links' if @link %>
<%= render :partial => 'services' if @services %>

<!-- File list -->
<div id="package_files">
  <h3>
    Uploaded Files
    <% if @project.is_maintainer?( session[:login] ) || @package.is_maintainer?( session[:login] ) %>
    <%= link_to image_tag('list-add.png', :alt => "Add", :title => "Add File"), 
    :action => :add_file, :project => @project, :package => @package %>
    <% end %>
  </h3>
  <% if !@files.empty? %>
  <table class="grid">
    <% @files.each do |file| %>
    <tr>
      <% next if file[:name].match(/^_service/) %>
      <% if file[:editable] %>
        <td><%= link_to(h(file[:name]), :action => :view_file, :project => @project, :package => @package, :file => file[:name] ) %></td>
      <% else %>
        <td><%= file[:name] %></td>
      <% end %>
      <td><%=h human_readable_fsize( file[:size] )%></td>
      <td><%= link_to "[Download]", file_url( @project, @package, file[:name] ) %></td>
      <% if @project.is_maintainer?( session[:login] ) || @package.is_maintainer?( session[:login] ) %>
        <td><%= link_to "[Remove]", {:action => :remove_file, :project => @project,
        :package => @package, :filename => file[:name]},
        {:confirm => "Really remove file '#{file[:name]}'?", :method => :post }%></td>
      <% end %>
      <td>
        <% if @link && @link.has_add_patch?( file[:name] ) %>
        (Added Patch)
        <% elsif @link && @link.has_patch?( file[:name] ) %>
        (Global Patch)
        <% end %>
      </td>
      <td>
        last changed <%= fuzzy_time_string( Time.at(file[:mtime].to_i).to_s ) %>
      </td>
    </tr>
    <% end %>
  </table>
  <% end %>
  <% if @project.is_maintainer?( session[:login] ) || @package.is_maintainer?( session[:login] ) %>
  <p>
  <%= link_to "[Add File]", :action => :add_file, :project => @project, :package => @package %>
  </p>
  <% end %>
</div>

