<%
project_bread_crumb( 'Repository States' )
@pagetitle = "Repository States for #{@project.name}"
@metarobots = 'noindex'
-%>

<%= render :partial => "tabs" %>

<h1>Repository State</h1>

<!-- this page will also get other repository informations like jobhistory -->

<% if @project.has_element? :repository %>

  <% @project.each_repository do |repository| %>
    <% next if not params[:repository].blank? and params[:repository] != repository.name %>
    <div style="margin-bottom: 1.2em" id="<%= valid_xml_id(repository.name) %>" >

      <div>
        <strong><%= repository.name -%></strong>
      </div>

      <div>
         <h2>Publishing Path</h2>
         <%= link_to h(repository.name), repo_url( @project, repository.name ), :title => repository.name -%>
      </div>


      <div style="margin-top: 1em">
         <h2>Build Dependendency Cycles</h2>
         <% repository.each_arch do |arch| %>
            <% if @repocycles[repository.name] and @repocycles[repository.name][arch.text] and @repocycles[repository.name][arch.text].length > 0 %>
                   <h3>Build dependency cycles for <%= arch.text %></h3>
                   <ul>
                   <% @repocycles[repository.name][arch.text].each do |cycle| %>
                      <li> <% cycle.each do |package| %>
                          <%= link_to package, :project => @project, :package => package, :controller => :package, :action => :show %>
                          <% if package == cycle.last %> 
                               <!-- carriage return -->
                               &#8629;
                          <% else %>
                               <!-- right arrow -->
                               &#8658;
                          <% end %>
                      <% end %>
                      </li>
                   <% end %>
                   </ul>
            <% end %>
          <% end %>
      </div>

    </div>
  <% end %>
<% end %>

<div class="clear" style="margin-bottom: 2em"></div>

