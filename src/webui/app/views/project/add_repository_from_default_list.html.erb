<% @pagetitle = "Add Repository"
   @metarobots = 'noindex'
   project_bread_crumb( 'Add Repository' ) 
-%>

<%= render :partial => "tabs" %>

<h2>Add Repositories to Project <%=h @project%></h2>

<p>Please choose the repositories that your packages will be built for by following default list. Or 
<%= link_to "pick one via advanced interface", :action => :add_repository, :project => @project %>.
</p>

<% form_tag( {:action => :save_targets, :project => @project} ) do -%>

  <% vendors = @distributions.find( 'distribution/@vendor' ).map{|d| d.value}.uniq %>

  <% vendors.each do |vendor| %>
    <h3><%= image_tag( "distributions/#{vendor.downcase}.png", :width => 40 ) %> <%=h vendor -%> distributions</h3>
    <p>
      <% for dist in @distributions.find("distribution[@vendor='#{vendor}']")
        name = dist.find('name').first.content
        project = dist.find('project').first.content
        repo = dist.find('repository').first.content
        reponame = dist.find('reponame').first.content
        selected = false
        selected = true if @project.has_element?("repository/path[@project='#{project}' and @repository='#{repo}']")
        -%>

        <span class="nowrap"><%= check_box_tag 'repo[]', h(reponame), selected, :disabled => selected, :id => 'repo_' + h(reponame), :class => "repocheckbox" -%>
          <%= hidden_field_tag h(reponame) + "_repo", h(project + '/' + repo) -%>
          <% DEFAULT_ENABLED_ARCHITECTURES.each do |arch| %>
            <%= hidden_field_tag h(reponame) + "_arch[]", arch, :id => h(reponame) + "_arch_" + h(arch) -%>
          <% end %>

          <%= h name %>
        </span>
      <% end -%>
    </p>
  <% end -%>

  <h3><%= image_tag( "distributions/kiwi.png", :width => 40 ) %> Kiwi image builds</h3>
  <p>
    <span class="nowrap">

      <% selected = false
      selected = true if @project.has_element?("repository[@name = 'images']") -%>

      <%= check_box_tag 'repo[]', 'images', selected, :disabled => selected, :id => 'repo_images', :class => "repocheckbox" -%>
      <input id="images_repo" name="images_repo" value="" type="hidden"/>
      <% DEFAULT_ENABLED_ARCHITECTURES.each do |arch| %>
        <input id="images_arch_<%=arch%>" name="images_arch[]" value="<%=arch%>" type="hidden"/>
      <% end %>
      KIWI image build <i>(to be used for appliance and product builds with kiwi)</i>        </span>
  </p>

  <p>
    <%= submit_tag 'Add selected repositories', :disabled => true, :id => 'submitrepos' -%>
  </p>
<% end %>



<% content_for :content_for_head do %>
  <%= javascript_include_tag 'jquery.autocomplete.pack' %>
  <%= javascript_include_tag 'jquery.ajaxmanager' %>
  <%= stylesheet_link_tag 'jquery.autocomplete' %>
<% end %>

<% content_for :ready_function do %>
  $('.repocheckbox').click(function() { $('#submitrepos').enable(); } );
<% end -%>

