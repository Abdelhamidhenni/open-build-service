<%
@crumb_list = [
  link_to( 'Projects', :action => :list_public),
  @project.name
]
-%>

<h2 id="mainhead"><%=h @project.title %></h2>
<h4>Project ID: <%=h @project %></h4>

<%= render :partial => "watch_link" %>

<div class="description">
  <% if @project.description =~ /\s/ -%>
  <i>No description set</i>
  <% else -%>
  <%=h @project.description %><br/>
  <% end -%>
</div>
<%= link_to "[Edit Project Information]", :action => 'edit', :project => @project %>



<table id="project-layout">
  <tr>
    <td>

      <!-- Tags -->
      <div class="section" id="tags">
        <h3>Tags</h3>
        <i>coming soon</i>
      </div>


      <!-- Category  Selection -->
      <div class="section" id="category">
        <h3>Category</h3>
        <i>coming soon</i>
      </div>


      <!-- Maintainer List -->
      <div class="section" id="contacts">
        <h3>People</h3>
        <% if @project.has_element? :person -%>
        <dl>
          <dt>Maintainers</dt>
          <% @project.each_person do |person| -%>
          <dd>
          <%=h person.userid %>
          <%- if @project.each_person.length > 1 %>
          <%= link_to "[x]",
          {:action => :remove_person, :project => params[:project], :userid => person.userid, :role => person.role},
          {:confirm => "Really remove user '#{person.userid}'?", :class => "x"}%>
          <%- end %>
          <% end #each_person -%>
          </dd>
        </dl>
        <% else -%>
        <b>No maintainer in this project</b>
        <% end #if has_element? person -%>
        <p><%= link_to "[Add Maintainer]", :action => :add_person, :project => params[:project] %></p>
      </div>
    </td>


    <td>
      <!-- Package table -->
      <h3>Packages</h3>
      <% if @project.has_element? :package -%>
      <table class="grid">
        <% @project.each_package do |package| -%>
        <tr>
          <td><%= link_to package.name, :controller => 'package', :action => :show,
            :project=> @project, :package => package %></td>
          <td><%= link_to "[Remove]", {:controller => 'package', :action => :remove,
            :project => @project, :package => package}, {:confirm => "Really remove package '#{package.name}'?", :class => 'x'} %></td>
        </tr>
        <% end #each_package -%>
      </table>
      <% end #has_element? -%>
      <p>
      <%= link_to "[Add Package]", :controller => 'package', :action => :new,
      :project => @project %>
      </p>
      <p>
      <%= link_to "[Link Package from other Project]", :controller => 'package',
      :action => :new_link, :project => @project %>
      </p>
    </td>


    <td>
      <!-- Repository table -->
      <h3>Build Repositories</h3>
      <% if @project.has_element? :repository -%>
      <table class="grid targets">
        <tr class="header">
          <th>Name</th>
          <% @arch_list.each do |arch| -%>
          <th><%=h arch %></th>
          <% end -%>
          <th>Action</th>
        </tr>
        <% @project.each_repository do |repo| -%>
        <tr class="target">
          <th>
            <strong><%=h repo.name %></strong>
            <% begin -%>
            <%=h repo.path.project+"/"+repo.path.repository %>
            <% rescue; end %>
          </th>
          <% @arch_list.each do |arch| -%>
          <td><%= format_packstatus_for( repo.name, arch )%></td>
          <% end -%>
          <td><%= link_to "[Remove]", {:action => :remove_target, :project => @project, :target => repo.name},
                                      {:confirm => "Really remove repository '#{repo.name}'?", :class => 'x'} %></td>
        </tr>
        <% end #each_repository -%>
      </table>

      <% end #has_element? -%>
      <p><%= link_to "[Add Repository]", :action => 'add_target_simple', :project => @project %></p>
      
      <% if @project.has_element?(:package) and @project.has_element?(:repository) -%>
      <p><%= link_to "[Monitor Build Status]", :action => :monitor, :project => params[:project] %></p>
      <% else -%>
      <p><i>Add packages/repositories to enable the build monitor</i></p>
      <% end -%>

    </td>

</table>
