<h3><%= @pagetitle %></h3>

<div style="display: inline">
  <% form_tag({:controller => 'project', :action => 'list'}, {:method => :get, :id => 'filter_projects_form' }) do %>
    <p>
      <strong>Filter projects:</strong>
      <%= text_field_tag "searchtext", @filterstring -%>
      <%= check_box_tag 'excludefilter', 'home:', (@excludefilter.nil? ? false : true) -%>Exclude user home projects

      <% if session[:login] %>
        <span style="float: right">
          <%= link_to image_tag('icons/brick_add.png', :title => 'Create project'), :controller => :project, :action => :new %>
          <%= link_to 'Create new project', :controller => :project, :action => :new %>
        </span>
      <% end %>
    </p>
  <% end-%>
</div>

<%#TODO: Finish porting these to jQuery, http://www.simonecarletti.com/blog/2010/06/unobtrusive-javascript-in-rails-3/%>
<%#TOOD: Or port to dataTables instead %>
<%# observe_field( :searchtext, :frequency => 0.8, :update => :project_list,
  :url => { :controller => 'project', :action  => :list },
  :loading => '$("#searchtext").addClass( "ac_loading" )', :complete => "$('#searchtext').removeClass( 'ac_loading' )",
  :with => "'searchtext=' + encodeURIComponent(value) + '&excludefilter=' + $('#excludefilter:checked').attr('value')") %>
<%# observe_field( :excludefilter, :frequency => 0.5, :update => :project_list,
  :url => { :controller => 'project', :action  => :list },
  :loading => '$("#searchtext").addClass( "ac_loading" )', :complete => "$('#searchtext').removeClass( 'ac_loading' )",
  :with => "'searchtext=' + encodeURIComponent($('#searchtext').attr('value')) + '&excludefilter=' + $('#excludefilter:checked').attr('value')") %>
<% javascript_tag do %>
  jQuery(function($) {
    $('#searchtext').change(function() {
      $.post('<%= url_for(:controller => 'project', :action  => 'list') %>', function(data) {
        $('#project_list').html(data);
      });
    });
    $('#excludefilter').change(function() {
      $.post('<%= url_for(:controller => 'project', :action  => 'list') %>', function(data) {
        $('#project_list').html(data);
      });
    });
  })
<% end %>
