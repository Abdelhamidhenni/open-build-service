<% content_for :head_javascript do %>

  var imagestoload = 0;

  function finishedPlot() 
  {
	imagestoload -= 1;
	if (imagestoload <= 0) {
	     $("#plots_updating").fadeOut(1200);
        }
  }

  function updatePlots()
  {
     if (imagestoload > 0)
        return;
     $("#plots_updating").fadeIn(1200);
     imagestoload = 0;
     $(".monitorplot").each(function() {
	imagestoload += 1;
	var src = $(this).attr('src');
        if (src.indexOf("&fake") == -1) {
	   src += "&fake=";
        }
        src += "1";
        $(this).attr('src', src);
     }).load(finishedPlot);
  }
<% end %>

<% content_for :ready_function do %>
       setInterval("updatePlots()", 20 * 60 * 1000 );
<% end %>

<h1>History <span id="plots_updating" class="hidden">(updating...)</span></h1>
<%= render :partial => 'graphs_arch', :locals => { :title => "i586 and x86_64", :prefix => 'pc_' } %>
<%= render :partial => 'graphs_arch', :locals => { :title => "Power", :prefix => 'ppc_' } %>
<%= render :partial => 'graphs_arch', :locals => { :title => "Arm", :prefix => 'arm_' } %>
<div style="clear: both"></div>
